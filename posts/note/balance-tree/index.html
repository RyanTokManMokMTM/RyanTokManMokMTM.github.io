<!doctype html><html lang=zh-tw data-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.147.8"><link rel="shortcut icon" type=image/x-icon href=/imgs-custom/customIcon/favicon.ico><link rel=icon type=image/x-icon href=/imgs-custom/customIcon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs-custom/customIcon/favicon_16x16.png><link rel=icon type=image/png sizes=32x32 href=/imgs-custom/customIcon/favicon_32_32.png><link rel=apple-touch-icon sizes=180x180 href=/imgs-custom/icons/apple_touch_icon_next.png><meta itemprop=name content="[筆記] 平衡樹 Balance Tree"><meta itemprop=description content="balance tree"><meta name=description content="balance tree"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://ryantokmanmokmtm.github.io/imgs-custom/customIcon/avatar.jpg"><meta itemprop=keywords content="data structure"><link href=/css/pio.css rel=stylesheet type=text/css><link type=text/css rel=stylesheet href=https://ryantokmanmokmtm.github.io/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=https://ryantokmanmokmtm.github.io/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://ryantokmanmokmtm.github.io/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.min.css?=1749921714"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><link rel=stylesheet type=text/css href="/css/custom_style.css?=1749921714"><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>[筆記] 平衡樹 Balance Tree - Jackson.tmm</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Jackson.tmm</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Loving life and dreams.</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>Home 首頁</a></li><li class="menu-item menu-item-categories"><a href=/categories/ class=hvr-icon-pulse rel=section><i class="fa fa-list hvr-icon"></i>Menu 目錄</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>About 關於</a></li><li class="menu-item menu-item-posts"><a href=/posts/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>Archives 歸檔</a></li><li class="menu-item menu-item-memories"><a href=/memories class=hvr-icon-pulse rel=section><i class="fa fa-star hvr-icon"></i>Memories 回憶</a></li><li class="menu-item menu-item-leetcodes"><a href=/leetcodes class=hvr-icon-pulse rel=section><i class="fa fa-code hvr-icon"></i>Leetcodes 力扣</a></li><li class="menu-item menu-item-project"><a href=/project class=hvr-icon-pulse rel=section><i class="fa fa-tasks hvr-icon"></i>Project 專案</a></li><li class="menu-item menu-item-achievement"><a href=/achievement class=hvr-icon-pulse rel=section><i class="fa fa-trophy hvr-icon"></i>Achievement 成就</a></li><li class="menu-item menu-item-resources"><a href=/resources class=hvr-icon-pulse rel=section><i class="fa fa-file hvr-icon"></i>Resources 資源</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目錄</li><li class=sidebar-nav-overview>站點概覽</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#簡介>簡介</a></li><li><a href=#什麼是平衡樹>什麼是平衡樹</a><ul><li><a href=#avl-樹avl-tree---self-balanced-binary-search-tree>AVL 樹(AVL Tree) - self balanced binary search tree</a></li><li><a href=#紅黑樹red-black-tree>紅黑樹(Red-black Tree)</a><ul><li><a href=#紅黑樹的特徵property>紅黑樹的特徵(property)</a></li><li><a href=#紅黑樹的插入和旋轉>紅黑樹的插入和旋轉</a></li><li><a href=#紅黑樹建立過程>紅黑樹建立過程</a></li></ul></li><li><a href=#b樹b-tree家族>B樹(B Tree)家族</a><ul><li><a href=#b-tree>B-Tree</a></li><li><a href=#b-樹>B+ 樹</a></li></ul></li></ul></li><li><a href=#總結>總結</a></li><li><a href=#參考資料>參考資料</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Jackson.tmm src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/customIcon/avatar.jpg><p class=site-author-name itemprop=name>Jackson.tmm</p><div class=site-description itemprop=description>簡單紀錄生活和筆記</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>34</span>
<span class=site-state-item-name>日誌</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>14</span>
<span class=site-state-item-name>分類</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>58</span>
<span class=site-state-item-name>標籤</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://www.facebook.com/karot.ka.7505/ title="Facebook → https://www.facebook.com/karot.ka.7505/" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-facebook fa-fw hvr-icon"></i>
Facebook
</a></span><span class=links-of-social-item><a href=https://www.instagram.com/tm_m.0418 title="IG → https://www.instagram.com/tm_m.0418" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-instagram fa-fw hvr-icon"></i>
IG
</a></span><span class=links-of-social-item><a href=https://github.com/RyanTokManMokMTM title="Github → https://github.com/RyanTokManMokMTM" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=https://www.linkedin.com/in/jackson-moktokman/ title="LinkedIn → https://www.linkedin.com/in/jackson-moktokman/" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-linkedin fa-fw hvr-icon"></i>
LinkedIn</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hant class=cc-opacity rel=noopener target=_blank title=共享知識><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知識></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://cwksc.github.io/ title=https://cwksc.github.io/ target=_blank>CWKSC 一個什麼都學得會的人</a></li></ul></div></div>--></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>網站資訊</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已運行：</div><div class=item-count id=runTimes data-publishdate="2022-03-24 13:52:49 +0800 +0800"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>總訪客數：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>頁面瀏覽：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>總字數：</div><div class=item-count id=wordsCount data-count=55102></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>閱讀約：</div><div class=item-count id=readTimes data-times=130></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最後更新於：</div><div class=item-count id=last-push-date data-lastpushdate="2024-12-02 23:31:33 +0800 +0800"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直達評論><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深淺模式切換><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回頂部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/RyanTokManMokMTM rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://ryantokmanmokmtm.github.io/posts/note/balance-tree/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs-custom/customIcon/avatar.jpg"><meta itemprop=name content="Jackson.tmm"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Jackson.tmm"><meta itemprop=description content="簡單紀錄生活和筆記"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="[筆記] 平衡樹 Balance Tree"><meta itemprop=description content="balance tree"></span><header class=post-header><h1 class=post-title itemprop="name headline">[筆記] 平衡樹 Balance Tree</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=發表於>發表於：
</span><time title="創建時間：2024-10-31 15:28:20 +08:00" itemprop="dateCreated datePublished" datetime="2024-10-31 15:28:20 +0800 +0800">2024-10-31
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新於>更新於：
</span><time title="修改時間：2024-11-23 15:28:20 +08:00" itemprop="dateModified dateLastmod" datetime="2024-11-23 15:28:20 +0800 +0800">2024-11-23
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分類於>分類於：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/note/ itemprop=url rel=index><span itemprop=name>note</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字數><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字數：</span>
<span>2694</span>
</span><span class=post-meta-item title=閱讀><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>閱讀：&ap;</span>
<span>6分鐘</span>
</span><span class=post-meta-item title=瀏覽><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>瀏覽：
</span><span id=busuanzi_value_page_pv data-path=/posts/note/balance-tree/><i class="fa fa-sync fa-spin"></i>
</span></span><span class=post-meta-item title><span class=post-meta-item-icon><i class="fas fa-solid fa-comments"></i>
</span><span class=post-meta-item-text title=評論>評論：
</span><span id=comments-count class=waline-comment-count data-path=/posts/note/balance-tree/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><div class=post-summary-wrapper><div class=summary-title><span><i class="fa-solid fa-list"></i></span>
<span>總結摘要</span></div><div class=summary-content>balance tree</div></div><h2 id=簡介>簡介
<a class=header-anchor href=#%e7%b0%a1%e4%bb%8b></a></h2><p>在講述Balance Tree之前，我們先來看一種情況。現在我們根據數據來建立一棵Binary Search Tree，譬如說以下的數據 : [4,5,6,7,8,9,10], 我們就會建立出以下這顆 Binary Search Tree:<br><img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/balance-tree/unblanceTree.png alt=unbalance-tree></p><a id=more></a><p>從這顆樹上我們會發現它其實就只是一個Linked List，查詢/插入效率還是一樣是O(n)，為了解決這個問題這裡需要<strong>平衡樹</strong>來幫忙解決。</p><h2 id=什麼是平衡樹>什麼是平衡樹
<a class=header-anchor href=#%e4%bb%80%e9%ba%bc%e6%98%af%e5%b9%b3%e8%a1%a1%e6%a8%b9></a></h2><p>從上述可見，查詢的效率是取決於樹的深度，那是不是可以將過深的分支平均到其他分支，使得每顆子樹的深度都差不多，是不是就可以大大提高查詢效率了呢？因此，平衡樹(Balance tree)就是為了解決這個問題而誕生的！
將上述例子轉換成平衡樹的話，會變成這個樣子：
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/balance-tree/balanceTree.png alt=balance-tree></p><p>這樣我們查詢的效率從O(n)減少到了O(logn)。<br>接下來會簡單介紹幾個比較常見的平衡樹</p><h3 id=avl-樹avl-tree---self-balanced-binary-search-tree>AVL 樹(AVL Tree) - self balanced binary search tree
<a class=header-anchor href=#avl-%e6%a8%b9avl-tree---self-balanced-binary-search-tree></a></h3><p>AVL樹又稱平衡二元樹，透過節點旋轉的方式使得子樹的高度差介於1之間，也就是說最深的子樹和最淺的子樹之間的高度不會大於1層。<br>AVL樹有以下特點：</p><ol><li>基於二元樹(BST)數據結構</li><li>通過自旋的方式建構平衡樹</li><li>每個節點保存1筆數據</li><li>左右子樹是一棵平衡樹</li><li>子節點保存1份數據</li></ol><p><strong>自旋方式</strong>
<em>找到不平衡tree的根(root)節點對該節點做旋轉，也就是最近的一個祖先(ancestor)。</em>
<strong>對不平衡樹的root的3個節點做旋轉，其他節點旋時暫時無視，旋轉過後再處理(放到合理的位置)</strong></p><blockquote><p>左子樹不平衡</p></blockquote><ol><li>左左旋轉 - LL rotation
就是左子樹的左邊跟右子樹不平衡，這個選擇比較簡單：</li></ol><ul><li>對不平衡樹的根節點做<em>右旋轉</em>就可以了。
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/balance-tree/LL-rotate.png alt=ll-rorate>
<em>在fig 2中，對A節點做了旋轉後，BR節點會變成了A節點的左子樹，因為BR節點在原本的樹中為右子樹，所以永遠都會在B節點的右邊且比A小。</em></li></ul><ol start=2><li>左右旋轉 - LR rotation</li></ol><ul><li>對不平衡樹的左子樹節點做左旋，再對根節點做右旋
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/balance-tree/LR-rotate.png alt=lr-rorate></li></ul><blockquote><p>右子樹不平衡 - 跟上面差不多，只是做反方向</p></blockquote><ol><li>右右不平衡 - RR rotation</li></ol><ul><li>對不平衡的根節點做<em>左旋轉</em>
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/balance-tree/RR-rotate.png alt=RR-rorate>
<em>在fig 2中，對A節點做了旋轉後，BL節點會變成了A節點的右子樹，因為BRL節點在原本的樹中為左子樹，所以永遠都會在B節點的左邊且比A大。</em></li></ul><ol start=2><li>右左不平衡 - RL rotation</li></ol><ul><li>對不平衡樹的左子樹節點做右旋，再對根節點做左旋
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/balance-tree/RL-rotate.png alt=RL-rorate></li></ul><p><strong>平衡樹的問題</strong></p><ol><li>數據多時，自旋處理多</li><li>數據多時，樹高度越來越高，影響查詢效率</li></ol><h3 id=紅黑樹red-black-tree>紅黑樹(Red-black Tree)
<a class=header-anchor href=#%e7%b4%85%e9%bb%91%e6%a8%b9red-black-tree></a></h3><p>紅黑色也就是字面上的意思，樹上只有黑色和紅色2種節點，是一種BST。主要還優化了AVL Tree旋轉的問題。</p><p><img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/balance-tree/red-black-tree.png alt=red-black-tree></p><h4 id=紅黑樹的特徵property>紅黑樹的特徵(property)
<a class=header-anchor href=#%e7%b4%85%e9%bb%91%e6%a8%b9%e7%9a%84%e7%89%b9%e5%be%b5property></a></h4><ol><li>節點分為紅色與黑色</li><li>Root節點必須為黑色</li><li>紅色節點的子節點(children)必須為黑色(也就是說紅色節點不能相連)</li><li>葉子節點都為空的黑色節點</li><li>任意節點到葉子節點所包含的黑色節點都為相同的數量</li><li>樹的高度h &lt;= 2*log(n+1)</li></ol><p>在講解操作之前，先說明一下<code>樹的高度h &lt;= 2*log(n+1)</code>
這裡我一顆二元樹為<code>n</code>層，最多容納的數量為<code>2^n - 1</code>個節點。 這邊給出2個定義：</p><blockquote><p>h(x): 從節點(x)到葉子節點的高度<br>bh(x): 從節點(x)到葉子節點的黑色節點的高度</p></blockquote><p>現在我們先從一顆完整二元樹(Complete binary tree)來看(這邊去掉了所有紅色節點):
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/balance-tree/complete-bt.png alt=complete-bt></p><p>從上面的節點公式我們可以得出以下結論：<br>$$
2^{hb(x)} + 1 \leq n
$$$$
hb(x) \leq log{_2}(n + 1)
$$</p><p>所以說一顆 complete binary tree 的最大高度是不超過 $$log{_2}(n + 1)$$ 的話，那紅黑樹的最大深度<code>h</code>, 是不是就是不會超過2倍的<code>bh(x)</code>,$$h(x) \leq 2*log{_2}(n+1)$$</p><p><strong>Q: 為什麼是2倍？而不是3倍？4倍？呢</strong>
<strong>A: 因為紅黑樹的定義，紅色節點的字節點必須是黑色，那最理想的狀態是不是就是紅黑相間的樹，也就是說在這顆全黑節點之間插入紅色節點，也就最多插入bh(x)多層的紅色節點</strong>
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/balance-tree/proof-bh-and-h-rbt.png alt=proof></p><h4 id=紅黑樹的插入和旋轉>紅黑樹的插入和旋轉
<a class=header-anchor href=#%e7%b4%85%e9%bb%91%e6%a8%b9%e7%9a%84%e6%8f%92%e5%85%a5%e5%92%8c%e6%97%8b%e8%bd%89></a></h4><p>插入新數據時按著以下規則進行插入:</p><ol><li>因為是BST，所以跟著BST查詢到合適的位置</li><li>插入的節點需為紅色節點</li><li>換色/旋轉操作使得符合紅黑樹定義</li></ol><p>這裡會有幾個不同的case:</p><ol><li>插入的是root - 不符合<code>root節點為黑色</code>特徵<br>將紅色節點換成黑色就可以了。
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/balance-tree/insert-a-root-rbt.png alt=insert-a-root></li><li>插入的節點與它的parent節點都皆為紅色 - 不符合<code>紅色節點的子節點為黑色</code>特徵<ol><li><p>parent節點與它的sliding都為紅色的情況:<br>換顏色就可以了 - <code>parent和sliding 換成黑色，其grandparent換成紅色</code>
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/balance-tree/silbing-red-rbt.png alt=silbing-red></p></li><li><p>parent節點的sliding都為黑色的情況:
這裡會有2個case(這裡只說明再左子樹的情況，右子樹也是一樣的做法，旋轉方向不一樣而已。<strong>這裡的旋轉方式跟AST是一樣的！</strong>)</p><ol><li>插入的節點在右子樹</li><li>插入的節點在左子樹</li></ol><p>旋轉完過後就換顏色就可以了，parent和sibling換成紅色，其grandparent換成黑色，就解決了紅色節點相鄰的問題了
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/balance-tree/silbing-black-rbt.png alt=silbing-black></p></li></ol></li></ol><p><em>這些步驟會一直做，直到整顆樹都符合紅黑色的定義。圖中root為紅色的只是簡單演示，可當作其中的一顆subtree。</em></p><h4 id=紅黑樹建立過程>紅黑樹建立過程
<a class=header-anchor href=#%e7%b4%85%e9%bb%91%e6%a8%b9%e5%bb%ba%e7%ab%8b%e9%81%8e%e7%a8%8b></a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>基於[0,3,5,7,2,6,4]建立紅黑樹</span></span></code></pre></td></tr></table></div></div><p><img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/balance-tree/create-rb-tree.png alt=create-rb-tree></p><h3 id=b樹b-tree家族>B樹(B Tree)家族
<a class=header-anchor href=#b%e6%a8%b9b-tree%e5%ae%b6%e6%97%8f></a></h3><p>AVL tree 以及 red-black tree 都是基於二元樹來做調整和平衡的，但是如果數據很多的情況下，整顆樹的高度是不是就會變得很高，例如<code>n = 10000</code>, 其tree 的高度為:<br>$$
h = log{_2}(10000)
$$</p><p>因為每個節點最多存一筆數據，使得數據量越大樹的深度就會越深/高。那會不會有一種方法每個子節點並不只保存一筆數據而是可以保存多筆數據呢？B Tree就實作了這個！</p><h4 id=b-tree>B-Tree
<a class=header-anchor href=#b-tree></a></h4><p>B樹是一種平衡且多路的搜尋樹，多用於磁盤外部的資料結構。 B樹有以下的特徵：</p><ol><li>所有葉子節點都會在同一層</li><li>每個節點最多含有<code>m</code>個子節點</li><li>除了root和葉子節點外，都最少含有<code>ceil(m/2)</code>個子節點</li><li>如過root節點不是葉子，最少要有2個子節點</li><li>每個子節點包含<code>n</code>個key，且<code>ceil(m/2) - 1 &lt;= n &lt;= m - 1</code></li><li>key是按升序排序</li></ol><p><img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/balance-tree/b-tree.png alt=b-tree></p><h5 id=b-tree-簡單查詢>B-Tree 簡單查詢
<a class=header-anchor href=#b-tree-%e7%b0%a1%e5%96%ae%e6%9f%a5%e8%a9%a2></a></h5><p><img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/balance-tree/b-tree-search.png alt=b-tree-search></p><h5 id=b-tree-建立過程例子>B-Tree 建立過程例子
<a class=header-anchor href=#b-tree-%e5%bb%ba%e7%ab%8b%e9%81%8e%e7%a8%8b%e4%be%8b%e5%ad%90></a></h5><p><img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/balance-tree/create-b-tree.png alt=create-b-tree></p><p>如果單看資料庫結構的話可能會看不出有什麼問題，但是從硬碟結構的層面來看的話就會有效率的問題了。<br><em>關於硬碟的結構可以參考
<a href=https://zh.wikipedia.org/zh-tw/%E7%A1%AC%E7%9B%98 title=wiki rel="noopener external nofollow noreferrer" target=_blank class=exturl>wiki
<i class="fa fa-external-link-alt"></i>
</a>的說明，這裡就不多做說明了。</em></p><p>我們知道了數據是保存在了硬碟的seator(扇區/磁區)的，那就是說有儲存大小的限制。如果按著B-Tree的方式來儲存的話，每次讀取的時候都會把每個節點的數據都完整讀取出來，這樣就會使得每棵tree所能保存的key的大小有限,也就是說可能需要建立多棵樹才能保存多筆相關數據，所以B+ tree就是解決了這個問題。</p><h4 id=b-樹>B+ 樹
<a class=header-anchor href=#b-%e6%a8%b9></a></h4><p>基於B樹進行了優化。B樹的每個子節點，除了保存了key還都保存了完整數據，導致磁盤每一頁保存的key數據有限。</p><ul><li>非葉子節點只保存key，不保存數據</li><li>葉子節點保存了完整數據</li><li>葉子節點之間都有個pointer形成雙向linked-list</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/balance-tree/b+tree.png alt=b+_tree></p><h2 id=總結>總結
<a class=header-anchor href=#%e7%b8%bd%e7%b5%90></a></h2><p>我們在這邊文章中討論了二元搜尋樹(Binary search tree)的問題，也簡單了介紹了什麼是平衡樹(Balance Tree)以及常用的平衡樹種類:</p><ul><li>AVL Tree</li><li>Red-black Tree</li><li>B Tree</li><li>B+ Tree
這裡也是簡單介紹，如果日後有機會的話會根據每棵樹詳細的寫一篇文章來做探討。</li></ul><h2 id=參考資料>參考資料
<a class=header-anchor href=#%e5%8f%83%e8%80%83%e8%b3%87%e6%96%99></a></h2><ul><li><a href=https://zh.wikipedia.org/zh-tw/%E7%A1%AC%E7%9B%98 title=硬碟Wiki rel="noopener external nofollow noreferrer" target=_blank class=exturl>硬碟Wiki
<i class="fa fa-external-link-alt"></i></a></li><li><a href="https://www.youtube.com/watch?v=jDM6_TnYIqE" title=AVL-tree rel="noopener external nofollow noreferrer" target=_blank class=exturl>AVL-tree
<i class="fa fa-external-link-alt"></i></a></li><li><a href="https://www.youtube.com/watch?v=aPqz3jyl8ak" title=紅黑樹 rel="noopener external nofollow noreferrer" target=_blank class=exturl>紅黑樹
<i class="fa fa-external-link-alt"></i></a></li><li><a href=https://cloud.tencent.com/developer/article/1691641 title=B樹 rel="noopener external nofollow noreferrer" target=_blank class=exturl>B樹
<i class="fa fa-external-link-alt"></i></a></li></ul></div><footer class=post-footer><div class=post-tags><a href=/tags/data-structure/>data structure</a></div><hr><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知識 title=共享知識><ul><li class=post-copyright-title><strong>文章標題：</strong>
[筆記] 平衡樹 Balance Tree</li><li class=post-copyright-author><strong>本文作者： </strong>Jackson.tmm</li><li class=post-copyright-link><strong>本文鏈接：</strong>
<a id=post-cr-link href=https://ryantokmanmokmtm.github.io/posts/note/balance-tree/ title="[筆記] 平衡樹 Balance Tree">https://ryantokmanmokmtm.github.io/posts/note/balance-tree/</a></li><li class=post-copyright-license><strong>版權聲明： </strong>本作品採用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hant>BY-NC-SA</a> 授權協議。轉載請註明出處！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hant target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hant/white.svg title="Not By AI"></a></div></li></ul></div><div class=followme><span>歡迎關注我的其它發布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=https://www.instagram.com/tm_m.0418/><span class=icon><i class="fab fa-instagram"></i>
</span><span class=label>Instagram</span></a></div><div class=social-item><a target=_blank class=social-link href=https://www.linkedin.com/in/jackson-moktokman><span class=icon><i class="fab fa-linkedin"></i>
</span><span class=label>LinkedIn</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/posts/share/2024-swe-interview-summary/ rel=next title="2024年軟體工程師(Software engineer)面試總結"><i class="fa fa-chevron-left"></i> 2024年軟體工程師(Software engineer)面試總結</a></div><div class="post-nav-prev post-nav-item"><a href=/posts/project/chat-app-final-summary/ rel=prev title="[開發者日記] 聊天通訊APP(完結) - 總結">[開發者日記] 聊天通訊APP(完結) - 總結
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span></span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=utterances-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2022 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Jackson.tmm</span></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/live2d-widget@3.1.4/lib/L2Dwidget.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/live2d-widget@3.1.4/lib/L2Dwidget.0.min.js></script><div class="pio-container left"><div class=pio-action></div><canvas id=pio width=300 height=500></canvas></div></div><div class=elfsight-app-b04b61d3-ff26-4d9d-a289-163c1b59bd32 data-elfsight-app-lazy></div></div></footer><script class=next-config data-name=page type=application/json>{"clipboard":{"js":{"alias":"clipboard","file":"dist/clipboard.min.js","name":"clipboard.js","version":"2.0.11"}},"comments":true,"expired":false,"isHome":false,"isPage":true,"math":{"js":{"file":"es5/tex-mml-svg.js","name":"mathjax","version":"3.2.2"},"render":"mathjax"},"path":"balance-tree","permalink":"https://ryantokmanmokmtm.github.io/posts/note/balance-tree/","title":"[筆記] 平衡樹 Balance Tree","toc":true,"waline":{"commentcnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/comment.js","name":"comment","version":"2.15.8"}}}</script><script type=text/javascript src=https://ryantokmanmokmtm.github.io/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://ryantokmanmokmtm.github.io/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://ryantokmanmokmtm.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小時前","ds_hours":" 小時 ","ds_just":"剛剛","ds_min":" 分鐘前","ds_mins":" 分鐘","ds_month":" 個月前","ds_years":" 年 ","empty":"沒有找到任何搜索結果：${query}","hits":"找到 ${hits} 個搜索結果","hits_time":"找到 ${hits} 個搜索結果（用時 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":false,"lang":"zh-tw","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"slideInRight","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":false},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"utterances":{"cfg":{"issueterm":"pathname","label":"comments","repo":"RyanTokManMokMTM/RyanTokManMokMTM.github.io","theme":"github-light"},"js":"https://utteranc.es/client.js"},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://ryantokmanmokmtm.github.io/js/3rd"}},"version":"4.8.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"2.15.8"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"2.15.8"}}}</script><script type=text/javascript src="/js/main.min.js?=1749921713" defer></script><script type=text/javascript src="/js/clipboard.min.js?=1749921714" defer></script><script type=text/javascript src="/js/math.min.js?=1749921714" defer></script><script src=https://static.elfsight.com/platform/platform.js data-use-service-core defer></script><script src=/js/l2d.js></script><script src=/js/pio.js></script><script>var pio=new Paul_Pio({mode:"draggable",hidden:!0,content:{welcome:["歡迎來到Jackson的小宇宙！","今天天氣不錯，一起来玩吧！","博主有空的話，會寫一寫博客記錄一下!"],custom:[{selector:".home-social a:last-child",text:"在這里可以了解博主的日常噢~"},{selector:".post-item a",type:"read"},{selector:".post-content a, .page-content a",type:"link"}]},model:["/model/umaru/model.json","/model/tororo/tororo.model.json","/model/HN/nepmaid/model.json","/model/HN/nepgearswim/model.json","/model/HN/neptune_santa/model.json","/model/other/rem/model.json","/model/other/mei/model.json","/model/other/liang/2.json","/model/HN/noir_santa/model.json","/model/HN/noireswim/model.json","/model/other/blanc_normal/index.json","/model/other/88type_1809/normal/model.json","/model/other/88type_1809/destroy/model.json","/model/other/dsr50_1801/normal/model.json","/model/other/dsr50_1801/destroy/model.json","/model/other/g36c_1202/normal/model.json","/model/other/g36c_1202/destroy/model.json","/model/other/kp31_310/normal/model.json","/model/other/kp31_310/destroy/model.json","/model/other/kp31_1103/normal/model.json","/model/other/kp31_1103/destroy/model.json"],touch:["不可以這樣欺負我啦><"]})</script></body></html>