<!doctype html><html lang=zh-tw data-theme=dark><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.152.2"><link rel="shortcut icon" type=image/x-icon href=/imgs-custom/customIcon/favicon.ico><link rel=icon type=image/x-icon href=/imgs-custom/customIcon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs-custom/customIcon/favicon_16x16.png><link rel=icon type=image/png sizes=32x32 href=/imgs-custom/customIcon/favicon_32_32.png><link rel=apple-touch-icon sizes=180x180 href=/imgs-custom/icons/apple_touch_icon_next.png><meta itemprop=name content="[筆記] 資料庫索引(index)"><meta itemprop=description content="深入解析資料庫索引機制：B+ Tree、聚簇索引、二級索引、複合索引
探討索引如何提升查詢效率，包含回表機制和索引規則
以 MySQL InnoDB 為例的實務應用指南
"><meta name=description content="深入解析資料庫索引機制：B+ Tree、聚簇索引、二級索引、複合索引
探討索引如何提升查詢效率，包含回表機制和索引規則
以 MySQL InnoDB 為例的實務應用指南
"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="http://localhost:1313/imgs-custom/customIcon/avatar.jpg"><meta itemprop=keywords content="database"><link href=/css/pio.css rel=stylesheet type=text/css><link type=text/css rel=stylesheet href=http://localhost:1313/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=http://localhost:1313/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=http://localhost:1313/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.css?=1765127118"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><link rel=stylesheet type=text/css href="/css/custom_style.css?=1765127118"><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>[筆記] 資料庫索引(index) - Jackson.tmm</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Jackson.tmm</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Loving life and dreams.</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>Home 首頁</a></li><li class="menu-item menu-item-categories"><a href=/categories/ class=hvr-icon-pulse rel=section><i class="fa fa-list hvr-icon"></i>Menu 目錄</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>About 關於</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>Archives 歸檔
<span class=badge>97</span></a></li><li class="menu-item menu-item-techs"><a href=/techs/ class=hvr-icon-pulse rel=section><i class="fa fa-terminal hvr-icon"></i>Technology 科技與技術</a></li><li class="menu-item menu-item-memories"><a href=/memories class=hvr-icon-pulse rel=section><i class="fa fa-star hvr-icon"></i>Memories 回憶</a></li><li class="menu-item menu-item-"><a href=/leetcodes class=hvr-icon-pulse rel=section><i class="fa fa-code hvr-icon"></i>Leetcodes 力扣</a></li><li class="menu-item menu-item-project"><a href=/project class=hvr-icon-pulse rel=section><i class="fa fa-tasks hvr-icon"></i>Project 專案</a></li><li class="menu-item menu-item-achievement"><a href=/achievement class=hvr-icon-pulse rel=section><i class="fa fa-trophy hvr-icon"></i>Achievement 成就</a></li><li class="menu-item menu-item-resources"><a href=/resources class=hvr-icon-pulse rel=section><i class="fa fa-file hvr-icon"></i>Resources 資源</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目錄</li><li class=sidebar-nav-overview>站點概覽</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#簡介>簡介</a></li><li><a href=#索引index>索引(Index)</a><ul><li><a href=#什麼是索引>什麼是索引</a></li><li><a href=#資料庫索引的種類>資料庫索引的種類</a><ul><li><a href=#primary-key-index聚簇索引聚簇索引>Primary key index(聚簇索引/聚簇索引)</a></li><li><a href=#secondary-index-普通索引--二級索引>Secondary Index (普通索引 / 二級索引)</a></li><li><a href=#composite-index-複合索引--聯合索引>Composite Index (複合索引 / 聯合索引)</a></li></ul></li><li><a href=#innodb索引規則>InnoDB索引規則</a><ul><li><a href=#查詢條件包含主鍵>查詢條件包含主鍵</a></li><li><a href=#查詢條件不包含主鍵>查詢條件不包含主鍵</a></li><li><a href=#進一步提高索引查詢效率>進一步提高索引查詢效率</a></li></ul></li><li><a href=#索引失效>索引失效</a><ul><li></li></ul></li></ul></li><li><a href=#總結>總結</a></li><li><a href=#參考資料>參考資料</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Jackson.tmm src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/customIcon/avatar.jpg><p class=site-author-name itemprop=name>Jackson.tmm</p><div class=site-description itemprop=description>簡單紀錄生活和筆記</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>97</span>
<span class=site-state-item-name>日誌</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>14</span>
<span class=site-state-item-name>分類</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>62</span>
<span class=site-state-item-name>標籤</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://www.facebook.com/karot.ka.7505/ title="Facebook → https://www.facebook.com/karot.ka.7505/" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-facebook fa-fw hvr-icon"></i>
Facebook
</a></span><span class=links-of-social-item><a href=https://www.instagram.com/tm_m.0418 title="Instagram → https://www.instagram.com/tm_m.0418" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-instagram fa-fw hvr-icon"></i>
Instagram
</a></span><span class=links-of-social-item><a href=https://github.com/RyanTokManMokMTM title="Github → https://github.com/RyanTokManMokMTM" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=https://www.linkedin.com/in/jackson-moktokman/ title="LinkedIn → https://www.linkedin.com/in/jackson-moktokman/" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-linkedin fa-fw hvr-icon"></i>
LinkedIn</a></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
資源連結</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://cwksc.github.io/ title=https://cwksc.github.io/ target=_blank>CWKSC</a></li><li class=links-of-blogroll-item><a href=https://labuladong.online/algo/en/intro/leetcode/ title=https://labuladong.online/algo/en/intro/leetcode/ target=_blank>LeetCode Guide</a></li></ul></div><div><a href=https://git.io/typing-svg><img src="https://readme-typing-svg.demolab.com?font=LXGW+WenKai+TC&duration=3000&pause=1000&color=F78D53&center=true&vCenter=true&multiline=true&width=435&height=60&lines=%E6%9C%80%E5%A5%BD%E7%9A%84%E9%8C%AF%E8%AA%A4%E8%99%95%E7%90%86%E5%B0%B1%E6%98%AF%E4%B8%8D%E8%A6%81%E8%AE%93%E9%8C%AF%E8%AA%A4%E7%99%BC%E7%94%9F%E3%80%82;Simplicity+is+the+ultimate+sophistication." alt="Typing SVG"></a></div><div><a href=https://git.io/typing-svg><img src="https://readme-typing-svg.demolab.com?font=LXGW+WenKai+TC&duration=3000&pause=1000&color=FF53F0&background=FF000000&center=true&vCenter=true&multiline=true&width=435&height=70&lines=%E7%A8%8B%E5%BC%8F%E7%A2%BC%E5%BE%9E%E4%B8%8D%E8%AA%AA%E8%AC%8A%EF%BC%8C%E8%A8%BB%E9%87%8B%E6%9C%89%E6%99%82%E6%9C%83;Code+never+lies%2C+comments+sometimes+do." alt="Typing SVG"></a></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>網站資訊</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已運行：</div><div class=item-count id=runTimes data-publishdate="2021-12-31 20:22:11 +0800 HKT"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>總訪客數：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>頁面瀏覽：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>總字數：</div><div class=item-count id=wordsCount data-count=103155></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>閱讀約：</div><div class=item-count id=readTimes data-times=259></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最後更新於：</div><div class=item-count id=last-push-date data-lastpushdate="2025-05-17 14:34:24 +0800 HKT"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直達評論><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深淺模式切換><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回頂部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/RyanTokManMokMTM rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=http://localhost:1313/archives/note/database-index/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs-custom/customIcon/avatar.jpg"><meta itemprop=name content="Jackson.tmm"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Jackson.tmm"><meta itemprop=description content="簡單紀錄生活和筆記"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="[筆記] 資料庫索引(index)"><meta itemprop=description content="深入解析資料庫索引機制：B+ Tree、聚簇索引、二級索引、複合索引
探討索引如何提升查詢效率，包含回表機制和索引規則
以 MySQL InnoDB 為例的實務應用指南
"></span><header class=post-header><h1 class=post-title itemprop="name headline">[筆記] 資料庫索引(index)</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=發表於>發表於：
</span><time title="創建時間：2024-12-02 23:31:33 +08:00" itemprop="dateCreated datePublished" datetime="2024-12-02 23:31:33 +0800 HKT">2024-12-02
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分類於>分類於：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/note/ itemprop=url rel=index><span itemprop=name>note</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字數><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字數：</span>
<span>4871</span>
</span><span class=post-meta-item title=閱讀><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>閱讀：&ap;</span>
<span>10分鐘</span>
</span><span class=post-meta-item title=瀏覽><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>瀏覽：
</span><span id=busuanzi_value_page_pv data-path=/archives/note/database-index/><i class="fa fa-sync fa-spin"></i>
</span></span><span class=post-meta-item title><span class=post-meta-item-icon><i class="fas fa-solid fa-comments"></i>
</span><span class=post-meta-item-text title=評論>評論：
</span><span id=comments-count class=waline-comment-count data-path=/archives/note/database-index/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><div class=post-summary-wrapper><div class=summary-title><span><i class="fa-solid fa-list"></i></span>
<span>總結摘要</span></div><div class=summary-content>深入解析資料庫索引機制：B+ Tree、聚簇索引、二級索引、複合索引
探討索引如何提升查詢效率，包含回表機制和索引規則
以 MySQL InnoDB 為例的實務應用指南</div></div><h2 id=前言>前言
<a class=header-anchor href=#%e5%89%8d%e8%a8%80></a></h2><p>之前的文章中，我們有簡單探討過事務相關的課題，而在這篇文章就主要討論 Index 索引相關的課題！ 而索引也跟 B+ tree 相關，如果不了解B+ tree的同學可以去參考之前討論
<a href=/achievement/note/balance-tree title=平衡樹的文章>平衡樹的文章
</a>。</p><a id=more></a><h2 id=簡介>簡介
<a class=header-anchor href=#%e7%b0%a1%e4%bb%8b></a></h2><p>不知道大家有沒有在學習或者在網上在找資料優惠資料庫查詢效率的時候大部分的答案都是說「<strong>加索引</strong>」，在這篇文章中就會對「索引」進行簡單的探討。
在開始之前想先給讀者一些問題進行思考，並在閱讀本文過後再給出回答：</p><ol><li>什麼是索引？</li><li>為什麼加了「索引」可以提高查詢效率？</li><li>索引提高查詢效率的同時，能否再進一步提高效率呢？</li></ol><p><strong>本文是以MySQL和InnoDB為前提進行的討論!</strong></p><h2 id=索引index>索引(Index)
<a class=header-anchor href=#%e7%b4%a2%e5%bc%95index></a></h2><h3 id=什麼是索引>什麼是索引
<a class=header-anchor href=#%e4%bb%80%e9%ba%bc%e6%98%af%e7%b4%a2%e5%bc%95></a></h3><p>相信大家都有看過書對吧？沒看過也沒有關係，這邊就簡單介紹一下索引的概念吧！<br>如果大家在要幾百頁的書本裡面找到某一個特定的資料，那我們是不是會選擇到書本目錄中尋找呢？而這一頁也就是所謂的「目錄/索引頁(Index)」，透過查閱索引頁就能很快的找到</p><p><strong>書本目錄為例：</strong><br><strong>Harry Potter And The Chamber Of Secrets 的目錄頁：</strong><br><img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/sql-index/harry-potter-index.png alt=book-index></p><p>如果我們要看<em>Ch.9</em>，透過查看目錄就可以知道它在書本的 page 148，直接跳到148頁就好了。</p><p>在資料庫的層面上，也是一樣的情況，我們可以直接透過索引來快速的找到資料。那資料庫的索引到底長什麼樣子呢？<br>假設我們有以下情境：
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/sql-index/data.png alt=data></p><p>現在從圖中我們可以看得出來，數據頁1因滿了，插入新數據後就會被分成兩頁了，這樣如果我們要查詢數據的時候要怎麼知道數據都放在了那一頁上呢？<br>這裡我們是不是就需要一個新的數據頁來保存那些數據在那一頁，而這個用來保存數據的頁就叫做<strong>索引頁</strong>。
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/sql-index/index-page.png alt=index-page></p><p>隨著數據的增加，索引頁也會增加，也就變成我們我們熟悉的「B+ Tree」，所以索引樹也就是B+ Tree。
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/sql-index/B+index-tree.png alt=B+index-page></p><h3 id=資料庫索引的種類>資料庫索引的種類
<a class=header-anchor href=#%e8%b3%87%e6%96%99%e5%ba%ab%e7%b4%a2%e5%bc%95%e7%9a%84%e7%a8%ae%e9%a1%9e></a></h3><ol><li>Primary key index(主鍵索引/ 聚簇索引)</li><li>Secondary Index (普通索引 / 二級索引)</li><li>Composite Index (複合索引 / 聯合索引)</li></ol><h4 id=primary-key-index聚簇索引聚簇索引>Primary key index(聚簇索引/聚簇索引)
<a class=header-anchor href=#primary-key-index%e8%81%9a%e7%b0%87%e7%b4%a2%e5%bc%95%e8%81%9a%e7%b0%87%e7%b4%a2%e5%bc%95></a></h4><p>聚簇索引是一種唯一的索引，由InnnoDB自己生成的index。
聚簇索引有以下特點：</p><ol><li>聚簇索引樹中的非葉子節點用單鏈表連接。</li><li>聚簇索引樹中的葉子節點中包含了完整的資料</li></ol><h4 id=secondary-index-普通索引--二級索引>Secondary Index (普通索引 / 二級索引)
<a class=header-anchor href=#secondary-index-%e6%99%ae%e9%80%9a%e7%b4%a2%e5%bc%95--%e4%ba%8c%e7%b4%9a%e7%b4%a2%e5%bc%95></a></h4><p>聚簇索引只有在查詢條件包含主鍵時，才會生效。如果要查詢的條件不包含主鍵，那麼就不會生效。怎麼辦呢？ 若要加快其他條件的查詢效率，我們可以為條件添加一個索引。<strong>添加索引後，會為該條件建立一顆新的索引頁</strong>。 也就是主建索引頁跟二級索引頁是分開的。<br>為<code>age</code>這個欄位了一個index，就會建立一個新的索引頁。而這個二級索引頁跟聚簇索引頁的區別是：</p><ol><li>二級索引頁除了包含主鍵ID外，還包含了 <code>age</code> 這個欄位的值。</li><li>二級索引頁中的葉子節點不包含全部的數據。</li><li>二級索引頁排序根據 <code>age</code> 欄位的值。</li></ol><h4 id=composite-index-複合索引--聯合索引>Composite Index (複合索引 / 聯合索引)
<a class=header-anchor href=#composite-index-%e8%a4%87%e5%90%88%e7%b4%a2%e5%bc%95--%e8%81%af%e5%90%88%e7%b4%a2%e5%bc%95></a></h4><p>複合索引（Composite Index）是指在一個資料表中同時使用多個欄位來建立索引的情況。這邊跟普通索引的差不多的，只是建立的索引會包含多個不同的欄位。
例如為<code>age</code>和<code>name</code>這兩個欄位建立一個複合索引。不過這裡值得注意的是,<strong>建立(<code>age</code>,<code>namge</code>)以及建立(<code>name</code>,<code>age</code>)是不一樣的，他們會建立不同索引樹！</strong>
這邊先不說這兩個索引樹的差別，先賣個關子xD。
而這個複合索引頁跟二級索引的區別是：</p><ol><li>複合索引除了主鍵ID外，還包含了多個欄位的數據。</li><li>其他的二級索引無疑</li></ol><p>在討論其他課題前，在這邊有一條問題要大家思考：<br>Q: <strong>除了聚簇索引樹外，主建ID在這邊的作用會是什麼呢？ 這裡交給讀者思考一下，哈哈哈。</strong></p><h3 id=innodb索引規則>InnoDB索引規則
<a class=header-anchor href=#innodb%e7%b4%a2%e5%bc%95%e8%a6%8f%e5%89%87></a></h3><p>在討論添加索引的規則之前，我們先來看看一句查詢是如何透過索引來找到資料的。
假設我們現在有如下這個資料庫表：
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/sql-index/example-index-user.png alt=user-example>
<em>這邊只是簡單的示範一下，圖中只包含前幾筆資料用作演示</em></p><h4 id=查詢條件包含主鍵>查詢條件包含主鍵
<a class=header-anchor href=#%e6%9f%a5%e8%a9%a2%e6%a2%9d%e4%bb%b6%e5%8c%85%e5%90%ab%e4%b8%bb%e9%8d%b5></a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>12</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p>因為我們的User表格包含了聚簇索引樹，對聚簇索引樹進行Binary search就很快的找到了，id = 12的資料。
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/sql-index/pk-index-search.png alt=pk-index-search>
<em>查詢路徑為橘色路徑</em>
最後得出結果為:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>12</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Jonna&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>18</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>從上面的圖中可以看到,查詢條件包含了主鍵的情況下，透過索引就很快的找到資料。</p><h4 id=查詢條件不包含主鍵>查詢條件不包含主鍵
<a class=header-anchor href=#%e6%9f%a5%e8%a9%a2%e6%a2%9d%e4%bb%b6%e4%b8%8d%e5%8c%85%e5%90%ab%e4%b8%bb%e9%8d%b5></a></h4><p>現在為User表格添加二級以及聯合索引,索引分別為一下：</p><p>二級索引： <code>age</code>, 並生成一些索引樹(index), 這邊我們簡稱為「Age 二級索引樹」。
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/sql-index/2nd-index-tree.png alt=age-2nd-index></p><p>聯合索引： （<code>age</code>,<code>name</code>） 並生成一些索引樹(index), 這邊我們簡稱為「Age&amp;Name 聯合索引樹」。<br><img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/sql-index/composite-index-tree.png alt=composite-index></p><p>從上面圖可以看得出來 <em>「二級索引」</em> 以及 <em>「聯合索引」</em> 的主要區別是:</p><ul><li>聯合索引會包含1個或者多個非唯一欄位的數據</li><li>二級索引會包含1個唯一欄位的數據</li></ul><hr><p>現在來模擬包含「二級索引」以及「聯合索引」的查詢情境：</p><ol><li>查詢「二級索引」的查詢語句</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=o>`</span><span class=n>age</span><span class=o>`</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>18</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p>這裡的查詢語句包含了 <code>where age = 18</code> 這個查詢條件，而且我們也為<code>age</code>這個欄位建立了索引，所以直接透過「Age 二級索引樹」查詢資料，以下為查詢路徑:
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/sql-index/2nd-index-search.png alt=age-2nd-index-search></p><p>從圖中可以清晰看到，透過Binary Search 很快就能找到<code>age = 18</code>的資料。而在葉子節點中，也包含了查詢的資料 (select <code>id</code>,<code>age</code>)，因此直接返回就好了。
最終結果為：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2>2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3>3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span> <span class=p>:</span> <span class=mi>54</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>18</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ol start=2><li>查詢「聯合索引」的查詢語句</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>age</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>89</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;Ken&#34;</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p>這裡的查詢語句包含了 <code>where age = 89 and name = "Ken"</code> 這個查詢條件，而且我們也為<code>age</code>和<code>name</code>欄位建立了聯合索引，所以直接透過「Age&amp;Name 聯合索引樹」查詢資料，以下為查詢路徑:
<img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/sql-index/composite-index-search.png alt=composite-index-search>
從圖中可以清晰看到，透過Binary Search 很快就能找到<code>age = 89</code>和<code>name = "Ken"</code>的資料。而在葉子節點中，也包含了查詢的資料 (select <code>id</code>,<code>age</code>,<code>name</code>)，因此直接返回就好了。
最終結果為：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span> <span class=p>:</span> <span class=mi>44</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>89</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Ken&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span> <span class=p>:</span> <span class=mi>77</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>89</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Ken&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>有人可能會問：<strong>「上面兩個查詢語句都包含了查詢『索引樹的數據』，但如果要獲取其他數據怎麼辦？」</strong><br>還記得上面有問過讀者一個問題嗎？<strong>「ID在除了主建索引樹外的索引中的作用會是什麼呢？」</strong>。這裡就可以回答以上的這個問題了，哈哈哈！<br>我們有了這個主鍵ID，是不是就拿著這個ID回到聚簇索引樹就可以獲取完整的數據了(聚簇索引樹葉子包含了完整的數據)! 這個透過其他索引樹拿取ID再回到聚簇索引樹獲取數據的方式就是 <strong>「回表 (Back to the table)」</strong>。</p><p>但是除了回表外，這裡的ID還有另外的作用。就是當數據都一樣的情況下，怎麼排序？因為主鍵是唯一的，是不是就可以透過ID來排序了！<br><img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/sql-index/duplicate-data-sorting-by-id.png alt=duplicated-data-sorting></p><h4 id=進一步提高索引查詢效率>進一步提高索引查詢效率
<a class=header-anchor href=#%e9%80%b2%e4%b8%80%e6%ad%a5%e6%8f%90%e9%ab%98%e7%b4%a2%e5%bc%95%e6%9f%a5%e8%a9%a2%e6%95%88%e7%8e%87></a></h4><p>從上面的介紹過後，我們都對 <strong>「索引是什麼」</strong> 以及 **「索引如何加快查詢」**有個基本的理解，但是在運用上，我們要如何運用索引提高查詢效率呢？接下來給大家介紹一下。<br>其實要進一步提高查詢的效率，就是減少 <strong>「回表(Back to the table)」</strong> 這個動作。</p><p><strong>為什麼要減少回表或者避免回表呢？</strong><br>假設現在我們獲取到了查詢數據的ID，需要透過查詢聚簇索引樹來獲取完整的數據，然而非聚簇索引樹的數據的的排序方式是根據欄位的值來進行排序的，而非ID。若所需回表的數據就已經在記憶體中了，這樣效率不會太差，但需要到硬碟中讀取的話需要做IO的操作，而且所需所在頁可能分佈在了在不同位置上，從而導致隨機IO的情況(例如數據一共有10個頁，數據在第一頁跟最後一頁，就要讀取2個頁，而且不是在鄰近的位置)。</p><p>以下介紹的方法都是減少回表的方法，這些方法都是在查詢的時候透過索引來獲取數據的。</p><h5 id=索引覆蓋index-cover>索引覆蓋(Index Cover)
<a class=header-anchor href=#%e7%b4%a2%e5%bc%95%e8%a6%86%e8%93%8bindex-cover></a></h5><p>其實上面的例子就有出現過索引覆蓋的方法，簡單來說就是查詢的數據在索引樹中已經包含了，也就沒有必要再透過回表的方式來獲取數據了。<br>例如上述的<code>select age from user where age = 18</code> 這個查詢語句中，查詢的數據在二級索引樹中已經包含了，所以就不用再透過回表的方式來獲取數據了，直接返回就好了。</p><h5 id=索引下推index-condition-pushdownicp>索引下推(Index Condition Pushdown，ICP)
<a class=header-anchor href=#%e7%b4%a2%e5%bc%95%e4%b8%8b%e6%8e%a8index-condition-pushdownicp></a></h5><p>這樣是資料庫引擎(InnoDB)所提供的功能，我們無需自行操作，默認是開啟的。 <strong>MySQL5.6 才支持 ICP</strong>
這邊舉例說明就會知道什麼是「索引下推」了。</p><p>我們現在建立一個複合索引 (<code>age</code>,<code>name</code>), 並執行以下查詢語句：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>age</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>89</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s2>&#34;%en&#34;</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p>這裡只有<code>age</code>是可以走索引的，而模糊查詢<code>name</code>是無法走索引的，因為name沒有被覆蓋到，因此需要透過回表的方式來獲取數據。</p><p>在沒有ICP的情況下，會透過回表的方式來獲取數據，接著資料庫引擎在回傳所有符合<code>name = 89</code>的數據到 <code>Server</code> 層，最後 <code>Server</code> 層再透過 <code>where</code> 條件把不符合的模糊查詢 <code>name</code> 的數據過濾掉。</p><p>假設我們現在有一個情況，資料庫中有1萬條數據是符合<code>age = 89</code>，但<code>name</code>以<code>en</code>結尾的就只有1筆數據，在這樣的情況下，是不是就是要回表1萬次，最後在把1萬條數據返回給伺服器層再透過 <code>where</code> 條件把不符合的模糊查詢 <code>name</code> 的數據過濾掉？最後返回給 <code>Client</code> 的缺只有1筆數據，這樣效率會很差。</p><p>在有ICP的情況下，這樣的過濾方式直接在引擎層來完成。在我們的例子中<code>name</code>剛好是聯合索引的一部分，所以直接透過聯合索引的 <code>name</code> 欄位來判斷<code>name</code>是否包含<code>en</code>結尾，最後只有1筆數據符合，也就是只有1筆數據會進行回表操作。最後返回給 <code>Server</code> 的也就只有1筆數據。 從1萬次回表操作優化到了1次，大大提交了效率！
這裡的重點的無法走索引的條件<strong>是索引的一部分</strong>才能透過索引下推的方式。</p><h3 id=索引失效>索引失效
<a class=header-anchor href=#%e7%b4%a2%e5%bc%95%e5%a4%b1%e6%95%88></a></h3><p>有些情況下索引會失效，譬如說使用對索引使用了函數(SUM,AVG等)、比較反向運算子(&lt;>, != 等)等等。但這邊就先不討論這些情況，就討論一下最常見的最左匹配原則以及模糊查詢的情況</p><h5 id=最左匹配原則leftmost-match>最左匹配原則(Leftmost Match)
<a class=header-anchor href=#%e6%9c%80%e5%b7%a6%e5%8c%b9%e9%85%8d%e5%8e%9f%e5%89%87leftmost-match></a></h5><p>什麼是最左匹配原則呢？我們建立聯合索引的時候，會根據從左至右的順序來建立索引樹，例如(A,B,C)這個索引樹的規則就是這樣的:<br>如果數據A欄位的數據相同，就會根據B的數據來進行比較，如果B欄位的數據也相同，就會根據C欄位的數據來進行比較。最後葉子節點的排序就是根據這個索引(A,B,C)。</p><p><img src=/imgs/img-lazy-loading.gif data-src=/imgs-custom/helper/sql-index/leftmost-match.png alt=leftmost-match>
從圖中先根據<code>age</code>欄位進行了排序，同樣為<code>age = 1</code>的，則根據<code>name</code>繼續排序，最後再根據<code>code</code>進行排序，若都一樣則會用ID作為最後排序。<br>若符合最左匹配原則的話，就可以透過這顆索引樹來獲取數據，而不需要全表掃描。什麼情況是符合最左匹配原則呢？很簡單，只要查詢順序根據建立索引時候的順序來進行查詢就好了。</p><p>我們的索引是: (<code>age</code>,<code>name</code>,<code>code</code>),以下情況都可以走這個索引</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>age</span><span class=o>`</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>18</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p>因為包含了索引最左邊的<code>age</code>，所以符合最左匹配原則。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>age</span><span class=o>`</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>18</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;Jonna&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>age</span><span class=o>`</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;Jonna&#34;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>18</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p>這2句都可以走索引，因為也包含了<code>age</code>這個最左的欄位，而且不用理會他們的順序問題，因為優化器會幫我們優化！</p><p>但如果是這種情況就會失效</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>age</span><span class=o>`</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>`</span><span class=n>Andy</span><span class=o>`</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p>因為我們的索引是是先根據<code>age</code>來進行排序的，如果要先找<code>name</code>這筆數據的話，而<code>name</code>沒有<code>age</code>過濾的情況下尋找，就跟全表掃描一樣的效果。因為只看<code>name</code>的數據在這個索引樹中是沒有排序可言的，可能<code>Andy</code>在最前面，另外一個<code>Andy</code>在最後面，都不知道哪個在前面，所以就是全表掃描的效果。</p><p>所以一句話概況就是<strong>最左索引欄位</strong>要包含在查詢條件中,才能走這顆索引樹。</p><h5 id=模糊查詢>模糊查詢
<a class=header-anchor href=#%e6%a8%a1%e7%b3%8a%e6%9f%a5%e8%a9%a2></a></h5><p>只有以下這幾種情況模糊查詢會導致索引失效:</p><ul><li><code>name LIKE %en</code></li><li><code>name LIKE %en%</code></li></ul><p>因為我們的索引樹根據字符進行排序的，而以上的情況都不考慮<code>name</code>前面的字符串為何，也就無法進行比較，所以就會進行全表掃描。</p><p>不過<code>name LIKE ke%</code>這種情況下,依然可以走索引，因為可以對值進行前綴匹配(Prefix match)。</p><h2 id=總結>總結
<a class=header-anchor href=#%e7%b8%bd%e7%b5%90></a></h2><p>在這邊文章中，我們簡單的討論了：</p><ul><li>索引是什麼以及索引如何加快搜尋的</li><li>如何在高效使用Index以及什麼是回表操作並避免回表操作<ul><li>索引覆蓋(Index cover)</li><li>索引下推(Index Condition Pushdown)</li></ul></li><li>索引失效的常見情況<ul><li>最左匹配原則(Leftmost-match)</li><li>模糊查詢(LIKE)</li></ul></li></ul><p>還記得前面給各位讀者提出的問題嗎，相信各位讀者心中已經知道答案了，這裡我就不再重複了xD。</p><ol><li>什麼是索引？</li><li>為什麼加了「索引」可以提高查詢效率？</li><li>索引提高查詢效率的同時，能否再進一步提高效率呢？</li></ol><p>希望這篇文章讓大家對索引有更深入的了解，謝謝大家！<br>如果有任何補充或者錯誤，歡迎在留言區留言喔!</p><h2 id=參考資料>參考資料
<a class=header-anchor href=#%e5%8f%83%e8%80%83%e8%b3%87%e6%96%99></a></h2><p><a href=https://juejin.cn/achievement/7075528696748048420#heading-13 title=聊一聊怎么用好MySQL索引这件事儿 rel="noopener external nofollow noreferrer" target=_blank class=exturl>聊一聊怎么用好MySQL索引这件事儿
<i class="fa fa-external-link-alt"></i></a><br><a href=https://ithelp.ithome.com.tw/articles/10230362 title="MySQL 系列文 - 索引的相關知識(5) - 何謂 ICP (Index Condition Pushdown)" rel="noopener external nofollow noreferrer" target=_blank class=exturl>MySQL 系列文 - 索引的相關知識(5) - 何謂 ICP (Index Condition Pushdown)
<i class="fa fa-external-link-alt"></i></a></p></div><footer class=post-footer><div class=post-tags><a href=/tags/database/>database</a></div><hr><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知識 title=共享知識><ul><li class=post-copyright-title><strong>文章標題：</strong>
[筆記] 資料庫索引(index)</li><li class=post-copyright-author><strong>本文作者： </strong>Jackson.tmm</li><li class=post-copyright-link><strong>本文鏈接：</strong>
<a id=post-cr-link href=http://localhost:1313/archives/note/database-index/ title="[筆記] 資料庫索引(index)">http://localhost:1313/archives/note/database-index/</a></li><li class=post-copyright-license><strong>版權聲明： </strong>本作品採用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hant>BY-NC-SA</a> 授權協議。轉載請註明出處！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hant target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hant/white.svg title="Not By AI"></a></div></li></ul></div><div class=followme><span>歡迎關注我的其它發布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=https://www.instagram.com/tm_m.0418/><span class=icon><i class="fab fa-instagram"></i>
</span><span class=label>Instagram</span></a></div><div class=social-item><a target=_blank class=social-link href=https://www.linkedin.com/in/jackson-moktokman><span class=icon><i class="fab fa-linkedin"></i>
</span><span class=label>LinkedIn</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/archives/memories/summary-of-2024/ rel=next title="2024年度總結(2024 annual summary)"><i class="fa fa-chevron-left"></i> 2024年度總結(2024 annual summary)</a></div><div class="post-nav-prev post-nav-item"><a href=/archives/note/database-transaction/ rel=prev title="[筆記] 淺談資料庫事務(Transcation)">[筆記] 淺談資料庫事務(Transcation)
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span></span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=utterances-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2022 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Jackson.tmm</span></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/live2d-widget@3.1.4/lib/L2Dwidget.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/live2d-widget@3.1.4/lib/L2Dwidget.0.min.js></script><div class="pio-container left"><div class=pio-action></div><canvas id=pio width=250 height=450></canvas></div></div><div class=elfsight-app-b04b61d3-ff26-4d9d-a289-163c1b59bd32 data-elfsight-app-lazy></div></div></footer><script class=next-config data-name=page type=application/json>{"clipboard":{"js":{"alias":"clipboard","file":"dist/clipboard.min.js","name":"clipboard.js","version":"2.0.11"}},"comments":true,"expired":false,"isHome":false,"isPage":true,"path":"database-index","permalink":"http://localhost:1313/archives/note/database-index/","title":"[筆記] 資料庫索引(index)","toc":true,"waline":{"commentcnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/comment.js","name":"comment","version":"2.15.8"}}}</script><script type=text/javascript src=http://localhost:1313/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=http://localhost:1313/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"http://localhost:1313/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小時前","ds_hours":" 小時 ","ds_just":"剛剛","ds_min":" 分鐘前","ds_mins":" 分鐘","ds_month":" 個月前","ds_years":" 年 ","empty":"沒有找到任何搜索結果：${query}","hits":"找到 ${hits} 個搜索結果","hits_time":"找到 ${hits} 個搜索結果（用時 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":false,"lang":"zh-tw","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"slideInRight","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":false},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"utterances":{"cfg":{"issueterm":"pathname","label":"comments","repo":"RyanTokManMokMTM/RyanTokManMokMTM.github.io","theme":"github-light"},"js":"https://utteranc.es/client.js"},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"http://localhost:1313/js/3rd"}},"version":"4.8.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"2.15.8"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"2.15.8"}}}</script><script type=text/javascript src="/js/main.js?=1765127118" defer></script><script type=text/javascript src="/js/clipboard.js?=1765127118" defer></script><script src=https://static.elfsight.com/platform/platform.js data-use-service-core defer></script><script src=/js/l2d.js></script><script src=/js/pio.js></script><script>var pio=new Paul_Pio({mode:"draggable",hidden:!0,content:{welcome:["歡迎來到Jackson的小宇宙！","今天天氣不錯，一起来玩吧！","博主有空的話，會寫一寫博客記錄一下!"],custom:[{selector:".home-social a:last-child",text:"在這里可以了解博主的日常噢~"},{selector:".post-item a",type:"read"},{selector:".post-content a, .page-content a",type:"link"}]},model:["/model/umaru/model.json","/model/tororo/tororo.model.json","/model/HN/nepmaid/model.json","/model/HN/nepgearswim/model.json","/model/HN/neptune_santa/model.json","/model/other/rem/model.json","/model/other/mei/model.json","/model/other/liang/2.json","/model/HN/noir_santa/model.json","/model/HN/noireswim/model.json","/model/other/blanc_normal/index.json","/model/other/88type_1809/normal/model.json","/model/other/88type_1809/destroy/model.json","/model/other/dsr50_1801/normal/model.json","/model/other/dsr50_1801/destroy/model.json","/model/other/g36c_1202/normal/model.json","/model/other/g36c_1202/destroy/model.json","/model/other/kp31_310/normal/model.json","/model/other/kp31_310/destroy/model.json","/model/other/kp31_1103/normal/model.json","/model/other/kp31_1103/destroy/model.json"],touch:["不可以這樣欺負我啦><"]})</script></body></html>