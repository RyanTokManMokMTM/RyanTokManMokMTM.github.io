<!doctype html><html lang=zh-TW data-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.128.0"><link rel="shortcut icon" type=image/x-icon href=/imgs/customIcon/favicon.ico><link rel=icon type=image/x-icon href=/imgs/customIcon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/customIcon/favicon_16x16.png><link rel=icon type=image/png sizes=32x32 href=/imgs/customIcon/favicon_32_32.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="[Note]Token Bucket algorithm introduction and play with golang rate Limiter"><meta itemprop=description content="Learning about Token Bucket algorithm and using golang rate package for implementating the limiter"><meta name=description content="Learning about Token Bucket algorithm and using golang rate package for implementating the limiter"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://ryantokmanmokmtm.github.io/imgs/customIcon/avatar.jpg"><meta itemprop=keywords content="golang package,rate limiter"><link href=/css/pio.css rel=stylesheet type=text/css><link type=text/css rel=stylesheet href=https://ryantokmanmokmtm.github.io/3rd/font-awesome/6.6.0/css/all.min.css><link type=text/css rel=stylesheet href=https://ryantokmanmokmtm.github.io/3rd/animate.css/4.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://ryantokmanmokmtm.github.io/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href=/css/main.min.fd06bdea3ec34c8476a794c94fe3a48bbc4be4e78e1efef59b825e62696e8c55.css><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":true,"isHome":false,"isPage":true,"path":"token-bucket-intro","permalink":"https://ryantokmanmokmtm.github.io/post/token-bucket-intro/","title":"[Note]Token Bucket algorithm introduction and play with golang rate Limiter","waline":{"js":[{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"2.15.8"},{"alias":"@waline/client","alias_name":"waline","file":"dist/comment.js","name":"comment","version":"2.15.8"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>[Note]Token Bucket algorithm introduction and play with golang rate Limiter - Jackson.tmm</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Jackson.tmm</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Loving life and dreams.</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>Home 首頁</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>About 關於</a></li><li class="menu-item menu-item-post"><a href=/post/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>Archive 歸檔</a></li><li class="menu-item menu-item-memories"><a href=/memories class=hvr-icon-pulse rel=section><i class="fa fa-star hvr-icon"></i>Memories 回憶</a></li><li class="menu-item menu-item-leetcodes"><a href=/leetcodes class=hvr-icon-pulse rel=section><i class="fa fa-code hvr-icon"></i>Leetcodes 力扣</a></li><li class="menu-item menu-item-achievement"><a href=/achievement class=hvr-icon-pulse rel=section><i class="fa fa-trophy hvr-icon"></i>Achievement 成就</a></li><li class="menu-item menu-item-project"><a href=/project class=hvr-icon-pulse rel=section><i class="fa fa-tasks hvr-icon"></i>Project 專案</a></li><li class="menu-item menu-item-resources"><a href=/resources class=hvr-icon-pulse rel=section><i class="fa fa-file hvr-icon"></i>Resources 資源</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目錄</li><li class=sidebar-nav-overview>站點概覽</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#token-bucket令牌桶算法>Token Bucket(令牌桶算法)</a><ul><li><ul><li><a href=#什麼是token-bucket-呢>什麼是Token Bucket 呢?</a></li></ul></li></ul></li><li><a href=#go-實現使用token-bucket>Go 實現/使用Token Bucket</a><ul><li><a href=#要如何新增一個limiter呢>要如何新增一個Limiter呢?</a></li><li><a href=#limiter的使用方式>Limiter的使用方式</a></li><li><a href=#allow>Allow</a></li><li><a href=#reserve>Reserve</a></li><li><a href=#wait>Wait</a></li><li><a href=#設定bucket-和-rate>設定Bucket 和 Rate</a></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Jackson.tmm src=/imgs/img-lazy-loading.gif data-src=/imgs/customIcon/avatar.jpg><p class=site-author-name itemprop=name>Jackson.tmm</p><div class=site-description itemprop=description>簡單紀錄生活和筆記</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>30</span>
<span class=site-state-item-name>日誌</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>29</span>
<span class=site-state-item-name>分類</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>56</span>
<span class=site-state-item-name>標籤</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://www.facebook.com/karot.ka.7505/ title="Facebook → https://www.facebook.com/karot.ka.7505/" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-facebook fa-fw hvr-icon"></i>
Facebook
</a></span><span class=links-of-social-item><a href=https://www.instagram.com/tm_m.0418 title="IG → https://www.instagram.com/tm_m.0418" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-instagram fa-fw hvr-icon"></i>
IG
</a></span><span class=links-of-social-item><a href=https://github.com/RyanTokManMokMTM title="Github → https://github.com/RyanTokManMokMTM" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=https://www.linkedin.com/in/jackson-moktokman/ title="LinkedIn → https://www.linkedin.com/in/jackson-moktokman/" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-linkedin fa-fw hvr-icon"></i>
LinkedIn</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知識><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知識></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa-solid fa-person-praying fa-fw"></i>
友情鏈接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://cwksc.github.io/ title=https://cwksc.github.io/ target=_blank>CWKSC 一個什麼都學得會的人</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>網站資訊</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已運行：</div><div class=item-count id=runTimes data-publishdate=2022-03-24T13:52:49+08:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>總訪客數：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>頁面瀏覽：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>總字數：</div><div class=item-count id=wordsCount data-count=32539></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>閱讀約：</div><div class=item-count id=readTimes data-times=83></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最後更新於：</div><div class=item-count id=last-push-date data-lastpushdate=2024-04-21T23:12:11+08:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直達評論><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深淺模式切換><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回頂部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/RyanTokManMokMTM rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://ryantokmanmokmtm.github.io/post/token-bucket-intro/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/customIcon/avatar.jpg"><meta itemprop=name content="jackson.tmm"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Jackson.tmm"><meta itemprop=description content="簡單紀錄生活和筆記"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="[Note]Token Bucket algorithm introduction and play with golang rate Limiter"><meta itemprop=description content="Learning about Token Bucket algorithm and using golang rate package for implementating the limiter"></span><header class=post-header><h1 class=post-title itemprop="name headline">[Note]Token Bucket algorithm introduction and play with golang rate Limiter</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=發表於>發表於：
</span><time title="創建時間：2022-03-29 18:33:07 +0800 +0800" itemprop="dateCreated datePublished" datetime="2022-03-29 18:33:07 +0800 +0800">2022-03-29
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分類於>分類於：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/system-design itemprop=url rel=index><span itemprop=name>golang/backend/note/algorithm/system design</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字數><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字數：</span>
<span>1953</span>
</span><span class=post-meta-item title=閱讀><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>閱讀：&ap;</span>
<span>4分鐘</span>
</span><span class=post-meta-item title=瀏覽><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>瀏覽：
</span><span id=busuanzi_value_page_pv data-path=/post/token-bucket-intro/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><h2 id=token-bucket令牌桶算法>Token Bucket(令牌桶算法)
<a class=header-anchor href=#token-bucket%e4%bb%a4%e7%89%8c%e6%a1%b6%e7%ae%97%e6%b3%95></a></h2><h4 id=什麼是token-bucket-呢>什麼是Token Bucket 呢?
<a class=header-anchor href=#%e4%bb%80%e9%ba%bc%e6%98%aftoken-bucket-%e5%91%a2></a></h4><blockquote><p>簡單來說就是運用Token Bucket的系統會以一個設定的速率往桶子(Bucket)裡面丟令牌(Token)。如果請求(Request)需要被處理時，就必需得Bucket裡的Token。當桶子裡面的沒有Token可以分配/獲取時，也就是說Bucket現在是空的(Token已經被其他令牌拿完了)，系統則會拒絕這個請求的服務。</p></blockquote><p>根據算法(Algorithm)的定義:</p><ul><li>A token is added to the bucket every <code>1/r</code> seconds. 一個Token會以每1/r秒加入到Bucket裡面。</li><li>The bucket can hold at the most <code>b</code> tokens. If a token arrives when the bucket <strong>is full</strong>, it is <strong>discarded</strong>. Bucket可以保存最多<code>b</code>個tokens。如果在bucket以及滿了的情況下，有一個token被加入到bucket，這個token會被丟棄</li><li><strong>例子:</strong><ul><li>假設一個n bytes的packet(封包)送達<ul><li>假設目前最少有n個token在桶子裡面，這n個token就會被拿出來，然後packet就會被送到網絡上(剛好n bytes 封包有n個tokens)</li><li>假設目前桶子裡面可存取的tokens少於n個，就不會有tokens被拿出來(因為需要n個tokens 才能傳送n bytes的封包)，這個封包會被考慮為不符合的封包/不合規的封包</li></ul></li></ul></li></ul><hr><h2 id=go-實現使用token-bucket>Go 實現/使用Token Bucket
<a class=header-anchor href=#go-%e5%af%a6%e7%8f%be%e4%bd%bf%e7%94%a8token-bucket></a></h2><p>Go 的time/rate package 提供了Limiter的實作，而這個Limiter便是實作了Token Bucket的方式來達到限流的目的。<br><strong>今天我們就來學習一下這麼使用go 提供Limiter來實作Rate Limiter</strong></p><h3 id=要如何新增一個limiter呢>要如何新增一個Limiter呢?
<a class=header-anchor href=#%e8%a6%81%e5%a6%82%e4%bd%95%e6%96%b0%e5%a2%9e%e4%b8%80%e5%80%8blimiter%e5%91%a2></a></h3><blockquote><p>func NewLimiter(r Limit, b int) *Limiter</p></blockquote><p>他有2個參數:</p><ul><li><strong>r</strong>: rate的type是<code>Limit</code>(一個float64的值)，表示著每秒會產生多少個Token,也就是每<code>1/r</code>秒生產1個token到bucket裡</li><li><strong>b</strong>: Token Bucket 的桶子的Capacity(容量)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>//r 設置100表示每秒會產生100個tokens到桶子裡面 1/100 s(1個)
</span></span></span><span style=display:flex><span><span style=color:#75715e>//b 設置為1表示桶子最多有1個token
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>limiter</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rate</span>.<span style=color:#a6e22e>NewLimiter</span>(<span style=color:#ae81ff>100</span>,<span style=color:#ae81ff>1</span>)
</span></span></code></pre></div><h3 id=limiter的使用方式>Limiter的使用方式
<a class=header-anchor href=#limiter%e7%9a%84%e4%bd%bf%e7%94%a8%e6%96%b9%e5%bc%8f></a></h3><p>Limiter提供了多個Function: <code>Allow</code>,<code>Reserve</code>,<code>Wait</code>,<code>AllowN</code>,<code>ReserveN</code>,<code>WaitN</code></p><p>最主要使用為以下的3個種Function(都會消耗一個Tokens):</p><ul><li><strong>Allow</strong><ul><li><code>func (lim *Limiter) Allow() bool</code> 是 <code>AllowN(time.Now(), 1)</code>的縮寫</li><li>它會<em>消耗</em>掉一個Tokens</li><li>如果有token的話會<code>return true</code> 否者會token不足 <code>return false</code></li></ul></li><li><strong>Reserve</strong><ul><li><code>func (lim *Limiter) Reserve() *Reservation</code> 是 <code>ReserveN(time.Now(), 1)</code>的縮寫</li><li>每次會<em>消耗</em>掉一個token</li><li>他主要的作用是保存event的資訊預約下一次的服務</li></ul></li><li><strong>Wait(用最多的function)</strong><ul><li><code>func (lim *Limiter) Wait(ctx context.Context) (err error)</code> 是 <code>WaitN(ctx, 1)</code>的縮寫</li><li>每次會<em>消耗</em>掉一個token</li><li>主要的作用就是等待直到被取消或者有足夠的Tokens</li><li><code>Wait</code> 會堵塞(block)直到有足夠的tokens才會往下執行</li></ul></li></ul><h3 id=allow>Allow
<a class=header-anchor href=#allow></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>lim</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Limiter</span>) <span style=color:#a6e22e>Allow</span>() <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>lim</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Limiter</span>) <span style=color:#a6e22e>AllowN</span>(<span style=color:#a6e22e>now</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>, <span style=color:#a6e22e>n</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>bool</span>
</span></span></code></pre></div><p><code>Allow()</code> 等價於(equivalent to) <code>AllowN(time.Now(),1)</code></p><p><code>AllowN</code>主要的作用</p><blockquote><p><code>AllowN</code> 表示的是在目前的時間點，是否能消耗n個token,如bucket存在n個token則 <code>return true</code> 否則 <code>return false</code></p><p><em>是想要Drop或者Skip超過rate limit的events時使用</em> 否則使用 <code>Reserve</code> 或者<code>Wait</code>取代
Use this method if you intend to drop / skip events that exceed the rate limit. Otherwise use Reserve or Wait.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>//AllowN的例子:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>AllowDemo</span>() {
</span></span><span style=display:flex><span>	<span style=color:#75715e>//each token generated every 100ms with 5 bucket
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>limiter</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rate</span>.<span style=color:#a6e22e>NewLimiter</span>(<span style=color:#a6e22e>rate</span>.<span style=color:#a6e22e>Every</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Microsecond</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>100</span>), <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Limiter rates : %v and bucket size : %v \n&#34;</span>, <span style=color:#a6e22e>limiter</span>.<span style=color:#a6e22e>Limit</span>(), <span style=color:#a6e22e>limiter</span>.<span style=color:#a6e22e>Burst</span>())
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>counter</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>counter</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>//each time we need 2 tokens
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>isAllowed</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>limiter</span>.<span style=color:#a6e22e>AllowN</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>(), <span style=color:#ae81ff>2</span>); <span style=color:#a6e22e>isAllowed</span> {
</span></span><span style=display:flex><span>			<span style=color:#75715e>//bucket have enough tokens
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Welcome!!!&#34;</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;user:%v is allowed in %v\n&#34;</span>, <span style=color:#a6e22e>counter</span>, <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Format</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>RFC3339</span>))
</span></span><span style=display:flex><span>		} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;user:%v is not allowed.Please wait for 100ms and try again later\n&#34;</span>, <span style=color:#a6e22e>counter</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>//wait for 100ms
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>100</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Microsecond</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=reserve>Reserve
<a class=header-anchor href=#reserve></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>lim</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Limiter</span>) <span style=color:#a6e22e>Reserve</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>Reservation</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>lim</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Limiter</span>) <span style=color:#a6e22e>ReserveN</span>(<span style=color:#a6e22e>now</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>, <span style=color:#a6e22e>n</span> <span style=color:#66d9ef>int</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>Reservation</span>
</span></span></code></pre></div><p><code>Reserve()</code> 等價於(equivalent to) <code>ReserveN(time.Now(),1)</code></p><p><code>ReserveN</code>的主要作用</p><blockquote><p><code>ReserveN</code> returns a Reservation that indicates how long the caller must wait before n events happen.</p><p>回傳一個<code>Reservation </code>表面在event執行前需要等待多久，這個<code>Reservation</code>被limiter納入考量內</p><p>如果<code>Reservation </code>的所需的token n超過bucket 的size時,<code>Reservation </code>的<code>OK()</code>會<code>return false</code></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>//Reserve例子:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ReserveDemo</span>() {
</span></span><span style=display:flex><span>	<span style=color:#75715e>//each token generated every 200ms and each second will put at most 5 tokens to bucket
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>limiter</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rate</span>.<span style=color:#a6e22e>NewLimiter</span>(<span style=color:#a6e22e>rate</span>.<span style=color:#a6e22e>Every</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span><span style=color:#f92672>*</span><span style=color:#ae81ff>200</span>), <span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Limiter rates : %v and bucket size : %v \n&#34;</span>, <span style=color:#a6e22e>limiter</span>.<span style=color:#a6e22e>Limit</span>(), <span style=color:#a6e22e>limiter</span>.<span style=color:#a6e22e>Burst</span>())
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>counter</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>counter</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>tokensNeeds</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>reserve</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>limiter</span>.<span style=color:#a6e22e>ReserveN</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>(), <span style=color:#a6e22e>tokensNeeds</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>reserve</span>.<span style=color:#a6e22e>OK</span>() {
</span></span><span style=display:flex><span>			<span style=color:#75715e>//this event won&#39;t be completed due to the tokens its needs
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;needed tokens %v is greater than the bucket size %v\n&#34;</span>, <span style=color:#a6e22e>tokensNeeds</span>, <span style=color:#a6e22e>limiter</span>.<span style=color:#a6e22e>Burst</span>())
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>//wait for the reversing time
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Wait for %v ms...\n&#34;</span>, <span style=color:#a6e22e>reserve</span>.<span style=color:#a6e22e>Delay</span>()) <span style=color:#75715e>//if dely is 0 that means no need to wait~
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>reserve</span>.<span style=color:#a6e22e>Delay</span>()) <span style=color:#75715e>//at least to wait for 200ms
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;waiting is done and now is allowed to deal with some tasks...\n&#34;</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;User %v,time : %v\n&#34;</span>, <span style=color:#a6e22e>counter</span>, <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Format</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>RFC3339</span>))
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=wait>Wait
<a class=header-anchor href=#wait></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>lim</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Limiter</span>) <span style=color:#a6e22e>Wait</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) (<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>lim</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Limiter</span>) <span style=color:#a6e22e>WaitN</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>n</span> <span style=color:#66d9ef>int</span>) (<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>)
</span></span></code></pre></div><p><code>Wait(ctx)</code> 等價於(equivalent to) <code>wait(time.Now(),1)</code></p><p><code>waitN</code>的主要作用</p><blockquote><p><code>WaitN</code> 每次需要消耗N個Tokens，如果Bucket沒有足夠的Bucket會堵塞，直到有足夠的Tokens(n)才會繼續往下只需。除非以下條件成立才會回傳錯誤:</p><ul><li>所需消耗tokens n大於bucket的size</li><li>Context 被取消</li><li>Context 已經超過設定的Deal line(等待時間超過了Deal line)</li></ul></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>//例子
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>WaitDemo</span>() {
</span></span><span style=display:flex><span>	<span style=color:#75715e>//at most 5 tokens will generate in a sec 200/1000=5
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>limiter</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rate</span>.<span style=color:#a6e22e>NewLimiter</span>(<span style=color:#a6e22e>rate</span>.<span style=color:#a6e22e>Every</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span><span style=color:#f92672>*</span><span style=color:#ae81ff>200</span>), <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Limiter rates : %v and bucket size : %v \n&#34;</span>, <span style=color:#a6e22e>limiter</span>.<span style=color:#a6e22e>Limit</span>(), <span style=color:#a6e22e>limiter</span>.<span style=color:#a6e22e>Burst</span>())
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>counter</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>counter</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>limiter</span>.<span style=color:#a6e22e>WaitN</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#ae81ff>2</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;error&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>		} <span style=color:#75715e>//wait for 2 tokens. At most wait for 400ms
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;User %v,time : %v\n&#34;</span>, <span style=color:#a6e22e>counter</span>, <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Format</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>RFC1123</span>))
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=設定bucket-和-rate>設定Bucket 和 Rate
<a class=header-anchor href=#%e8%a8%ad%e5%ae%9abucket-%e5%92%8c-rate></a></h3><p>可透過<code>func (lim *Limiter) SetBurst(newBurst int)</code>設定 <code>Bucket size</code><br>可透過<code>func (lim *Limiter) SetLimit(newLimit Limit)</code>設定 <code>Limit/Rate</code></p><hr><p>參考資料:<br><a href=https://pjchender.blogspot.com/2020/11/go-pkg-timerate-package.html title="[go-pkg] time/rate package" rel="noopener external nofollow noreferrer" target=_blank class=exturl>[go-pkg] time/rate package
<i class="fa fa-external-link-alt"></i></a><br><a href=https://pkg.go.dev/golang.org/x/time/rate title="rate Documentation" rel="noopener external nofollow noreferrer" target=_blank class=exturl>rate Documentation
<i class="fa fa-external-link-alt"></i></a></p></div><footer class=post-footer><div class=post-tags><a href=/tags/golang-package>golang package
</a><a href=/tags/rate-limiter>rate limiter</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知識><ul><li class=post-copyright-title><strong>文章標題：</strong>
[Note]Token Bucket algorithm introduction and play with golang rate Limiter</li><li class=post-copyright-author><strong>原文作者： </strong>jackson.tmm</li><li class=post-copyright-link><strong>本文鏈接：</strong>
<a id=post-cr-link href=https://ryantokmanmokmtm.github.io/post/token-bucket-intro/ title="[Note]Token Bucket algorithm introduction and play with golang rate Limiter">https://ryantokmanmokmtm.github.io/post/token-bucket-intro/</a></li><li class=post-copyright-license><strong>版權聲明： </strong>本博客所有文章除特別聲明外，均採用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 許可協議。轉載請註明出處！</li></ul></div><div class=followme><span>歡迎關注我的其它發布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=https://www.instagram.com/tm_m.0418/><span class=icon><i class="fab fa-instagram"></i>
</span><span class=label>Instagram</span></a></div><div class=social-item><a target=_blank class=social-link href=https://www.linkedin.com/in/jackson-moktokman><span class=icon><i class="fab fa-linkedin"></i>
</span><span class=label>LinkedIn</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/simple-ratelimiter-example-based-on-ip/ rel=next title="[Note]Simple RateLimiter Example Based on IP"><i class="fa fa-chevron-left"></i> [Note]Simple RateLimiter Example Based on IP</a></div><div class="post-nav-prev post-nav-item"><a href=/post/creational-factory/ rel=prev title=[Note]Creational-Factory>[Note]Creational-Factory
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span></span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=utterances-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2022 - 2024
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Jackson.tmm</span></div><div class=vendors-list><a target=_blank href=https://github.com title=Github><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/github.svg alt=Github>
</a><span>提供CDN/雲資源支持</span></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/live2d-widget@3.1.4/lib/L2Dwidget.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/live2d-widget@3.1.4/lib/L2Dwidget.0.min.js></script><div class="pio-container left"><div class=pio-action></div><canvas id=pio width=300 height=500></canvas></div></div><div class=elfsight-app-b04b61d3-ff26-4d9d-a289-163c1b59bd32 data-elfsight-app-lazy></div></div></footer><script type=text/javascript src=https://ryantokmanmokmtm.github.io/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://ryantokmanmokmtm.github.io/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#333","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://ryantokmanmokmtm.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小時前","ds_hours":" 小時 ","ds_just":"剛剛","ds_min":" 分鐘前","ds_mins":" 分鐘","ds_month":" 個月前","ds_years":" 年 ","empty":"沒有找到任何搜索結果：${query}","hits":"找到 ${hits} 個搜索結果","hits_time":"找到 ${hits} 個搜索結果（用時 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-TW","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"utterances":{"cfg":{"issueterm":"pathname","label":"comments","repo":"RyanTokManMokMTM/RyanTokManMokMTM.github.io","theme":"github-light"},"js":"https://utteranc.es/client.js"},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://ryantokmanmokmtm.github.io/3rd"}},"version":"4.6.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o \n\n可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄\n(Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"2.15.8"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"2.15.8"}}}</script><script type=text/javascript src=/js/main.min.5494f0e871d0c594b5d9f96f5d5e3bc7441306a5cf0570aae5847646c0b96e52.js defer></script><script src=https://static.elfsight.com/platform/platform.js data-use-service-core defer></script><script src=/js/l2d.js></script><script src=/js/pio.js></script><script>var pio=new Paul_Pio({mode:"draggable",hidden:!0,content:{welcome:["歡迎來到Jackson的小宇宙！","今天天氣不錯，一起来玩吧！","博主有空的話，會寫一寫博客記錄一下!"],custom:[{selector:".home-social a:last-child",text:"在這里可以了解博主的日常噢~"},{selector:".post-item a",type:"read"},{selector:".post-content a, .page-content a",type:"link"}]},model:["/model/umaru/model.json","/model/tororo/tororo.model.json","/model/HN/nepmaid/model.json","/model/HN/nepgearswim/model.json","/model/HN/neptune_santa/model.json","/model/other/rem/model.json","/model/other/mei/model.json","/model/other/liang/2.json","/model/HN/noir_santa/model.json","/model/HN/noireswim/model.json","/model/other/blanc_normal/index.json","/model/other/88type_1809/normal/model.json","/model/other/88type_1809/destroy/model.json","/model/other/dsr50_1801/normal/model.json","/model/other/dsr50_1801/destroy/model.json","/model/other/g36c_1202/normal/model.json","/model/other/g36c_1202/destroy/model.json","/model/other/kp31_310/normal/model.json","/model/other/kp31_310/destroy/model.json","/model/other/kp31_1103/normal/model.json","/model/other/kp31_1103/destroy/model.json"],touch:["不可以這樣欺負我啦><"]})</script></body></html>